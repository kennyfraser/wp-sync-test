---
UID: 56df3ded317a3
post_title: Installing Enterprise Edition (1.2)
post_excerpt: ""
layout: page
published: true
menu_order: 100
page_options_require_authentication: false
page_options_show_link_unauthenticated: false
hide_from_navigation: false
hide_from_related: false
---
<p>This topic provides instructions for installing <span class="caps">DCOS</span> in your environment by using a customized Bash install script.</p>

<p>The <span class="caps">DCOS</span> installation creates these folders:</p>

<ul>
<li><dl>
<dt><code>/opt/mesosphere</code></dt>
<dd>Contains all the <span class="caps">DCOS</span> binaries, libraries, cluster configuration. Do not modify.</dd>
</dl></li>
<li><dl>
<dt><code>/etc/systemd/system/dcos.target.wants</code></dt>
<dd>Contains the systemd services which start the things that make up systemd. They must live outside of <code>/opt/mesosphere</code> because of systemd constraints.</dd>
</dl></li>
<li><dl>
<dt>Various units prefixed with <code>dcos</code> in <code>/etc/systemd/system</code></dt>
<dd>Copies of the units in <code>/etc/systemd/system/dcos.target.wants</code>. They must be at the top folder as well as inside <code>dcos.target.wants</code>.</dd>
</dl></li>
</ul>

<p>The <span class="caps">DCOS</span> Enterprise Edition is installed in your environment by using a dynamically generated setup file. This file is generated by using specific parameters that are set during installation. This installation file contains a Bash install script and a Docker container that is loaded with everything you need to create a customized <span class="caps">DCOS</span> build.</p>

<h1>Prerequisites</h1>

<p>Contact your sales representative or <a href="mailto:&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;">&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;</a> to obtain the DCOS setup file.</p>

<h3 id="a-nameprerequisitesacluster-prerequisites"><a name="prerequisites"></a>Cluster prerequisites</h3>

<p>Before installing <span class="caps">DCOS</span> you must prepare your cluster environment.</p>

<ul>
<li><strong>Cluster</strong> A cluster of 8 or more machines with a supported Linux distribution. The recommended capacity for each node is 16 <span class="caps">GB</span> <span class="caps">RAM</span>/2 Cores and 16 <span class="caps">GB</span> disk space. </li>
<li><strong>Linux distribution</strong> A supported Linux distribution must be installed on your cluster: 

<ul>
<li>Enterprise Linux 7 (RedHat, Cent<span class="caps">OS</span>) </li>
<li>Core<span class="caps">OS</span> </li>
</ul></li>
<li><strong>Connected nodes</strong> All of the nodes in your cluster must be able to send and receive traffic to each other. </li>
<li><p><strong>Docker</strong> Docker version <span class="caps">1.6</span> or greater must be installed on your cluster nodes. You must run Docker commands as the root user (<code>sudo</code>). It is recommended that you install Docker by using this command:</p>

<pre><code>$ curl -sSL https://get.docker.com | sh
</code></pre>

<p>If you are running in userspace, you must add <code>usermod -aG docker &lt;username&gt;</code> to your command, where <code>&lt;username&gt;</code> is the user building the <span class="caps">DCOS</span> packages.</p>

<p>You can test that your Docker build is properly installed with these commands:</p>

<pre><code>$ sudo service docker start
$ sudo docker ps
</code></pre>

<p>If you are using <span class="caps">RHEL7</span>, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.</p></li>
<li><p><strong>Load balancer</strong> <em>For <span class="caps">DCOS</span> <span class="caps">1.2</span> and earlier:</em> A high-availability (<span class="caps">HA</span>) load balancer is used to balance these <span class="caps">TCP</span> ports on your master nodes: 80, 443, 8080, 8181, 2181, 5050</p></li>
<li><p><strong>Open Ports</strong> These ports must be open for all master nodes:</p>

<ul>
<li>5050 for Mesos masters </li>
<li>5051 for Mesos agent nodes </li>
<li>8080 for Marathon </li>
<li>2181 for Zookeeper, see the <a href="http://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html#sc_zkCommands" target="_blank"><span class="caps">ZK</span> Admin Guide</a> </li>
<li>8181, 2888, and 3888 for Exhibitor, see the <a href="https://github.com/Netflix/exhibitor/wiki/REST-Introduction" target="_blank">Exhibitor <span class="caps">REST</span> Documentation</a> </li>
</ul></li>
<li><p><strong>Shared storage</strong> During <span class="caps">DCOS</span> installation, a storage system is required for configuring and orchestrating Zookeeper with Exhibitor on the master nodes. Exhibitor automatically configures your Zookeeper installation on the master nodes during your <span class="caps">DCOS</span> installation. You can use either:</p>

<ul>
<li><p><strong>Zookeeper instance</strong><br />
<strong>Tip:</strong> To start a Zookeeper instance on the current host using Docker, run this command:</p>

<pre><code>docker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name=dcos_int_zk jplock/zookeeper`
</code></pre></li>
<li><p><strong>Amazon <span class="caps">S3</span> bucket</strong></p></li>
<li><p><strong>Shared file system, such as <span class="caps">NFS</span></strong></p></li>
</ul></li>
</ul>

<p><strong>Tip:</strong> If you’d like to clean up your cluster to install a new version or configuration instead of creating an entirely new cluster, follow these <a href="/cleanup/">cleanup instructions</a>.</p>

<hr />

<h1 id="a-nameconfig-clusterastep-1-prepare-your-cluster"><a name="config-cluster"></a>Step 1: Prepare your cluster</h1>

<p>In this step you prepare your cluster for <span class="caps">DCOS</span> installation.</p>

<ol>
<li><p>On each of your master and agent nodes, disable SELinux or set it to permissive mode. This enables <span class="caps">DCOS</span> services and Docker to function properly.</p>

<pre><code>$ sudo sed -i s/SELINUX=enforcing/SELINUX=permissive/g /etc/selinux/config
</code></pre>

<p><strong>Tip:</strong> You can verify the status of SELinux with the <code>sestatus</code>command.</p></li>
<li><p>Add <code>nogroup</code> to each of your Mesos masters and agents.</p>

<pre><code>$ sudo groupadd nogroup
</code></pre></li>
<li><p>Reboot your cluster for the changes to take affect:</p>

<pre><code>$ sudo reboot
</code></pre></li>
</ol>

<hr />

<h1><a name="create-script"></a>Step 2: Create a script for IP address discovery</h1>

<p>In this step you create an <span class="caps">IP</span> detect script to broadcast the <span class="caps">IP</span> address of each node across the cluster. Each node in a <span class="caps">DCOS</span> cluster has a unique <span class="caps">IP</span> address that is used to communicate between nodes in the cluster. The <span class="caps">IP</span> detect script prints the unique IPv4 address of a node to <span class="caps">STDOUT</span> each time <span class="caps">DCOS</span> is started on the node.</p>

<p><strong>Important:</strong> The <span class="caps">IP</span> address of a node must not change after <span class="caps">DCOS</span> is installed on the node. For example, the <span class="caps">IP</span> address must not change when a node is rebooted or if the <span class="caps">DHCP</span> lease is renewed. If the <span class="caps">IP</span> address of a node does change, the node must be <a href="/cleanup/">wiped and reinstalled</a>.</p>

<ol>
<li><p>Create a directory named <code>dcos/genconf</code> on your workstation.</p></li>
<li><p>Create an <span class="caps">IP</span> detection script for your environment and save as <code>genconf/ip-detect</code>.</p></li>
</ol>

<h3 id="examples">Examples</h3>

<ul>
<li><h4 id="query-an-authority">Query an authority</h4>

<p>Here is another example using the <span class="caps">AWS</span> Metadata service to get the <span class="caps">IP</span> address:</p>

<pre><code>#!/bin/sh
# Example ip-detect script using an external authority
# Uses the AWS Metadata Service to get the node's internal
# ipv4 address
curl -fsSL http://169.254.169.254/latest/meta-data/local-ipv4
</code></pre></li>
<li><h4 id="use-the-ip-address-of-an-existing-interface">Use the <span class="caps">IP</span> address of an existing interface</h4>

<p>This method discovers the <span class="caps">IP</span> address of a particular interface of the node.</p>

<p>If you have multiple generations of hardware with different internals, the interface names can change between hosts. The <span class="caps">IP</span> detection script must account for the interface name changes. The example script could also be confused if you attach multiple <span class="caps">IP</span> addresses to a single interface, or do complex Linux networking, etc.</p>

<pre><code>#!/usr/bin/env bash
set -o nounset -o errexit
export PATH=/usr/sbin:/usr/bin:$PATH
echo $(ip addr show eth0 | grep -Eo '[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}' | head -1)
</code></pre></li>
<li><h4 id="use-the-network-route-to-the-mesos-master">Use the network route to the Mesos master</h4>

<p>This method uses the route to a Mesos master to find the source <span class="caps">IP</span> address to then communicate with that node.</p>

<p>In this example, we assume that the Mesos master has an <span class="caps">IP</span> address of <code>192.168.1.1</code>. You can use any language for this script. Your Shebang line must be pointed at the correct environment for the language used and the output must be the correct <span class="caps">IP</span> address.</p>

<pre><code>#!/usr/bin/env bash
set -o nounset -o errexit

MASTER_IP=172.28.128.3

echo $(/usr/sbin/ip route show to match 172.28.128.3 | grep -Eo '[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}' | tail -1)
</code></pre></li>
</ul>

<hr />

<h1><a name="config-json"></a>Step 3: Configure your cluster</h1>

<p>In this step you create a <span class="caps">JSON</span> configuration file that is customized for your environment. <span class="caps">DCOS</span> uses this configuration file during installation to generate your cluster installation files.</p>

<p><strong>Important:</strong> This step is critical. Do not install <span class="caps">DCOS</span> until you have created this file.</p>

<p>Create a <span class="caps">JSON</span> configuration file and save as <code>config.json</code>. For examples and a complete description of the available <span class="caps">JSON</span> configuration parameters, see <a href="/configuration-parameters-1-2/">JSON config file options</a>.</p>

<p>Here is an example configuration, where the cluster name is <code>fs-example</code>, the number of Mesos masters is 3, the storage system for configuring and orchestrating Zookeeper with Exhibitor is a shared file system, :</p>

<pre><code>{
    "cluster_name": "fs-example",
    "num_masters": 3,
    "exhibitor_storage_backend": "shared_filesystem",
    "exhibitor_fs_config_dir": "/shared-mount",
    "repository_url":"file:///tmp/dcos",
    "bootstrap_url":"file:///tmp/dcos",
    "resolvers": "["10.10.5.1", "10.10.6.1"]",
    "master_lb": "10.10.20.1",
    "roles": "slave_public",
    "weights": "slave_public=1"
}
</code></pre>

<hr />

<h1 id="a-nameinstall-bashastep-4-configure-and-install-dcos"><a name="install-bash"></a>Step 4: Configure and install <span class="caps">DCOS</span></h1>

<p>In this step you create a custom <span class="caps">DCOS</span> build file on your workstation and then install <span class="caps">DCOS</span> onto your cluster.</p>

<p><strong>Workstation prerequisites:</strong></p>

<ul>
<li><strong>rsync utility</strong> The <a href="https://rsync.samba.org/" target="_blank">rsync utility</a> is used to distribute <span class="caps">DCOS</span> installation files to your cluster. </li>
<li><strong>Docker</strong> Docker must be installed on your workstation. If you are using <span class="caps">RHEL7</span>, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.</li>
</ul>

<ol>
<li><p>Download and save the DCOS setup file, <code>dcos_generate_config.sh</code>, to the <code>dcos</code> directory on your workstation. This file is used to create your customized DCOS build file.</p>

<p><strong>Important:</strong> Contact your sales representative or <a href="mailto:&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;">&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;</a> to obtain the DCOS setup file.</p></li>
<li><p>Run the <span class="caps">DCOS</span> setup script with your <a href="#create-script"><code>ip-detect.sh</code></a> and <a href="#config-json"><code>config.json</code></a> files as arguments. The setup script uses the generic <span class="caps">DCOS</span> install files in the Docker container to create customized <span class="caps">DCOS</span> build files for your cluster. The build files are output to <code>./genconf/serve/</code>.</p>

<pre><code>sudo bash setup_dcos.sh --config=config.json --ip-detect-script=ip-detect.sh
</code></pre>

<p><strong>Tip:</strong> The installation Docker container is not used again after this step.</p></li>
<li><p>Create a text file file that includes each of your master and agent nodes and save as <code>nodes.txt</code>. For example:</p>

<pre><code>10.0.0.1
10.0.0.2
10.0.0.3
10.0.0.4
10.0.0.5
</code></pre></li>
<li><p>Use the rsync utility to copy the customized <span class="caps">DCOS</span> build files to each of your cluster nodes. The following command copies the <span class="caps">DCOS</span> build files from <code>genconf/serve/</code> to a file location <code>/tmp/dcos/</code> on each of your nodes, as specified in <code>nodes.txt</code>.</p>

<pre><code>for ip in $(cat nodes.txt); do
  rsync -avhP genconf/serve/* centos@$ip:/tmp/dcos
done
</code></pre>

<p><strong>Important:</strong> The installation will fail if the file locations do not match the values as specified in your <span class="caps">JSON</span> configuration file.</p></li>
<li><p><span class="caps">SSH</span> into each master node and run this install command from the <code>dcos-setup</code> directory. This command installs <span class="caps">DCOS</span> into each master node using your custom build file.</p>

<pre><code>ssh MASTERS "cd /tmp/dcos; sudo bash dcos_install.sh master"
</code></pre>

<p><strong>Tip:</strong> Run this command on your master nodes one after another. Although there is no actual harm to your cluster, <span class="caps">DCOS</span> may issue error messages until all of your master nodes are configured.</p></li>
<li><p><span class="caps">SSH</span> into each agent node and run this command from the <code>dcos-setup</code> directory. This command installs <span class="caps">DCOS</span> into each agent node using your custom build file.</p>

<pre><code>ssh SLAVES "cd /tmp/dcos; sudo bash dcos_install.sh slave"
</code></pre></li>
<li><p>Monitor Exhibitor and wait for it to converge at http://<code>&lt;load-balanced-ip&gt;</code>:8181/exhibitor/v1/ui/index.html.</p>

<p><strong>Tip:</strong> This process can take about 10 minutes. During this time you will see the Master nodes become visible on the Exhibitor consoles and come online, eventually showing a green light.</p>

<p>When the status icons are green, you can access the <span class="caps">DCOS</span> web interface.</p>

<p><a href="https://docs.mesosphere.com/wp-content/uploads/2015/12/chef-zk-status.png" rel="attachment wp-att-2112"><img src="https://docs.mesosphere.com/wp-content/uploads/2015/12/chef-zk-status.png" alt="chef-zk-status" width="551" height="467" class="alignnone size-full wp-image-2112" /></a></p></li>
<li><p>Launch the <span class="caps">DCOS</span> web interface at: <code>http://</code>&lt; load-balanced-ip &gt;<code>/</code>:</p>

<p><a href="https://docs.mesosphere.com/wp-content/uploads/2015/12/dashboardsmall.png" rel="attachment wp-att-1120"><img src="https://docs.mesosphere.com/wp-content/uploads/2015/12/dashboardsmall.png" alt="dashboardsmall" width="1338" height="828" class="alignnone size-full wp-image-1120" /></a></p></li>
</ol>