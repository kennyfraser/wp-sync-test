---
UID: 56df3dee54aab
post_title: Installing Enterprise Edition (1.4)
post_excerpt: ""
layout: page
published: true
menu_order: 103
page_options_require_authentication: false
page_options_show_link_unauthenticated: false
hide_from_navigation: false
hide_from_related: true
---
<p><!-- 1.4 --> You can install DCOS in your environment by using a customized Bash install script.</p>

<p>The DCOS installation creates these folders:</p>

<ul>
<li><dl>
<dt><code>/opt/mesosphere</code></dt>
<dd>Contains all the DCOS binaries, libraries, cluster configuration. Do not modify.</dd>
</dl></li>
<li><dl>
<dt><code>/etc/systemd/system/dcos.target.wants</code></dt>
<dd>Contains the systemd services which start the things that make up systemd. They must live outside of <code>/opt/mesosphere</code> because of systemd constraints.</dd>
</dl></li>
<li><dl>
<dt>Various units prefixed with <code>dcos</code> in <code>/etc/systemd/system</code></dt>
<dd>Copies of the units in <code>/etc/systemd/system/dcos.target.wants</code>. They must be at the top folder as well as inside <code>dcos.target.wants</code>.</dd>
</dl></li>
</ul>

<p>The DCOS Enterprise Edition is installed in your environment by using a dynamically generated setup file. This file is generated by using specific parameters that are set during installation. This installation file contains a Bash install script and a Docker container that is loaded with everything you need to create a customized DCOS build.</p>

<p>Contact your sales representative or <a href="mailto:&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;">&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;</a> to obtain the DCOS setup file.</p>

<h1>Workstation prerequisites</h1>

<p>Before installing DCOS you must prepare your workstation environment.</p>

<ul>
<li><strong>Docker</strong> Docker version 1.6 or greater must be installed on your workstation. If you are using RHEL7, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.</li>
<li><p><strong>nginx Docker image</strong> The Docker nginx image must be on your workstation. You can use this command to install the nginx container:</p>

<pre><code> docker pull nginx
</code></pre>

<p>For more information, see <a href="https://hub.docker.com/_/nginx/" target="_blank">DockerHub nginx</a> documentation.</p></li>
<li><p><strong>Zookeeper for shared storage</strong> Shared storage is required by DCOS during installation and runtime for bootstrapping and managing the internal DCOS Zookeeper cluster. The Zookeeper for shared storage instance is used only for bootstrapping the DCOS Exhibitor instance.</p>

<p>Exhibitor automatically configures your Zookeeper installation on the master nodes during your DCOS installation. This Zookeeper instance should be separate from your cluster. Consider using a separate directory path for the DCOS cluster so that it does not interfere with other services that use the Zookeeper instance.</p>

<p>Temporary outages while the cluster is running are acceptable, but shared storage should generally be up and running to support replacing failed masters.</p>

<p><strong>Tip:</strong> To start a Zookeeper instance using Docker, run this command:</p>

<pre><code> $ docker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name=dcos_int_zk jplock/zookeeper
</code></pre>

<!-- Amazon S3 bucket
: This must be a preexisting S3 bucket. -->

<!-- Shared file system
: An Network File System (NFS) mount that Exhibitor can write to. --></li>
</ul>

<h1>Cluster prerequisites</h1>

<p>Before installing DCOS you must prepare your cluster environment.</p>

<ul>
<li><p><strong>Data compression</strong> You must have the <a href="http://www.info-zip.org/UnZip.html" target="_blank">UnZip</a>, <a href="https://www.gnu.org/software/tar/" target="_blank">GNU tar</a>, and <a href="http://tukaani.org/xz/" target="_blank">XZ Utils</a> data compression utilities installed on your cluster nodes.</p>

<p>To install these utilities on CentOS7 and RHEL7:</p>

<pre><code> yum install -y tar xz unzip curl
</code></pre></li>
<li><p><strong>Docker</strong> Docker version 1.6 or greater must be installed on your cluster nodes. You must run Docker commands as the root user (<code>sudo</code>). For more information, see <a href="http://docs.docker.com/engine/installation/">Docker installation</a>.</p>

<ul>
<li><p>You can install Docker by using this command:</p>

<pre><code> $ curl -sSL https://get.docker.com | sh
</code></pre>

<p>If you are using CentOS7 and behind a firewall, you can install docker with this command:</p>

<pre><code> $ yum install -y docker
</code></pre></li>
<li><p>You must enable the Docker service:</p>

<pre><code> $ sudo systemctl enable docker
</code></pre></li>
<li><p>If you are using Docker as a non-root user, you must add your user to the "docker" group:</p>

<pre><code> $ sudo usermod -aG docker &lt;user&gt;
</code></pre></li>
<li><p>You can test that your Docker build is properly installed with these commands:</p>

<pre><code> $ sudo service docker start 
 $ sudo docker ps
</code></pre></li>
<li><p>If you are using RHEL7, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.</p></li>
</ul></li>
<li><p><strong>Linux distribution</strong> A supported Linux distribution must be installed on your cluster:</p>

<ul>
<li>Enterprise Linux 7 (RedHat, CentOS)</li>
<li>CoreOS</li>
</ul></li>
<li><p><strong>Nodes</strong></p>

<ul>
<li>A cluster of 8 or more machines with a supported Linux distribution. The recommended capacity for each node is 16 GB RAM/2 Cores and 16 GB disk space. The minimum size of a node is a machine with 10 GB of disk space and 1 GB of RAM.</li>
<li>All of the nodes in your cluster must be able to send and receive traffic to each other.</li>
<li>IPv6 must be disabled for all nodes. For more information see <a href="https://wiki.centos.org/FAQ/CentOS7#head-8984faf811faccca74c7bcdd74de7467f2fcd8ee" target="_blank">How do I disable IPv6</a>.</li>
</ul></li>
<li><p><strong>Port configuration</strong></p>

<ul>
<li>ICMP must be enabled between the master and the agent nodes.</li>
<li>TCP and UDP enabled port 53 for DNS.</li>
<li>These ports must be open for communication to the master nodes. 

<ul>
<li>TCP port 5050 for Mesos masters</li>
<li>TCP port 8080 for Marathon</li>
<li>TCP port 2181 for Zookeeper, see the <a href="http://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html#sc_zkCommands" target="_blank">ZK Admin Guide</a></li>
<li>TCP ports 8181, 2888, and 3888 for Exhibitor, see the <a href="https://github.com/Netflix/exhibitor/wiki/REST-Introduction" target="_blank">Exhibitor REST Documentation</a></li>
</ul></li>
<li>These ports must be open for communication to the agent nodes from the master nodes: 

<ul>
<li>TCP port 5051 for Mesos agent communication.</li>
</ul></li>
</ul></li>
<li><p><strong>System updates</strong> Make sure you've updated your system to the latest version.</p>

<ul>
<li><p>On CentOS7 and RHEL7, you can use this command to update your system:</p>

<pre><code> $ yum upgrade -y
</code></pre></li>
</ul></li>
</ul>

<h1><a name="config-cluster"></a>Step 1: Prepare your cluster</h1>

<p>In this step you prepare your cluster for DCOS installation.</p>

<ol>
<li><p>On each of your master and agent nodes, disable SELinux or set it to permissive mode. This enables DCOS services and Docker to function properly.</p>

<pre><code>$ sudo sed -i s/SELINUX=enforcing/SELINUX=permissive/g /etc/selinux/config
</code></pre>

<p><strong>Tip:</strong> You can verify the status of SELinux with the <code>sestatus</code>command.</p></li>
<li><p>Add <code>nogroup</code> to each of your Mesos masters and agents.</p>

<pre><code>$ sudo groupadd nogroup
</code></pre></li>
<li><p>Reboot your cluster for the changes to take affect:</p>

<pre><code>$ sudo reboot
</code></pre></li>
</ol>

<h1><a name="create-script"></a>Step 2: Create a script for IP address discovery</h1>

<p>In this step you create an IP detect script that runs on each node in the cluster and outputs the node's local IP address. This IP is used to communicate with the other nodes in the cluster. For nodes with multiple IPs, make sure the script outputs the correct one. Each node in a DCOS cluster has a unique IP address that is used to communicate between nodes in the cluster. The IP detect script prints the unique IPv4 address of a node to STDOUT each time DCOS is started on the node.</p>

<p><strong>Important:</strong> The IP address of a node must not change after DCOS is installed on the node. For example, the IP address must not change when a node is rebooted or if the DHCP lease is renewed. If the IP address of a node does change, the node must be <a href="../dcos-cleanup-script/">wiped and reinstalled</a>.</p>

<p>To create a script for IP address discovery:</p>

<ol>
<li><p>Create a directory named <code>dcos/genconf</code> on your workstation.</p></li>
<li><p>Create an IP detection script for your environment and save as <code>genconf/ip-detect</code>.</p></li>
</ol>

<h2>Examples</h2>

<ul>
<li><h4>Query an authority</h4>

<p>Here is another example using the AWS Metadata service to get the IP address:</p>

<pre><code>#!/bin/sh
# Example ip-detect script using an external authority
# Uses the AWS Metadata Service to get the node's internal
# ipv4 address
curl -fsSL http://169.254.169.254/latest/meta-data/local-ipv4
</code></pre></li>
<li><h4>Use the IP address of an existing interface</h4>

<p>This method discovers the IP address of a particular interface of the node.</p>

<p>If you have multiple generations of hardware with different internals, the interface names can change between hosts. The IP detection script must account for the interface name changes. The example script could also be confused if you attach multiple IP addresses to a single interface, or do complex Linux networking, etc.</p>

<pre><code>#!/usr/bin/env bash
set -o nounset -o errexit
export PATH=/usr/sbin:/usr/bin:$PATH
echo $(ip addr show eth0 | grep -Eo '[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}' | head -1)
</code></pre></li>
<li><h4>Use the network route to the Mesos master</h4>

<p>This method uses the route to a Mesos master to find the source IP address to then communicate with that node.</p>

<p>In this example, we assume that the Mesos master has an IP address of <code>172.28.128.3</code>. You can use any language for this script. Your Shebang line must be pointed at the correct environment for the language used and the output must be the correct IP address.</p>

<pre><code>#!/usr/bin/env bash
set -o nounset -o errexit

MASTER_IP=172.28.128.3

echo $(/usr/sbin/ip route show to match 172.28.128.3 | grep -Eo '[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}' | tail -1)
</code></pre></li>
</ul>

<h1><a name="config-json"></a>Step 3: Configure your cluster</h1>

<p>In this step you create a JSON configuration file that is customized for your environment. DCOS uses this configuration file during installation to generate your cluster installation files. This step assumes that you are using Zookeeper for shared storage.</p>

<ol>
<li><p>Customize this <code>config.json</code> template file for your environment.</p>

<pre><code>{
   "bootstrap_url":"http://&lt;workstation_ip&gt;:&lt;your_port&gt;",
   "cluster_name": "&lt;cluster-name&gt;",
   "exhibitor_storage_backend": "zookeeper",
   "exhibitor_zk_hosts": "&lt;host1&gt;:&lt;port1&gt;",
   "exhibitor_zk_path": "/dcos",
   "master_discovery":"static",
   "master_list": "["&lt;master-ip-1&gt;","&lt;master-ip-2&gt;","&lt;master-ip-3&gt;"]",
   "resolvers": "["&lt;dns-resolver-1&gt;"]"
}
</code></pre></li>
<li><p>Specify these parameters for your environment.</p>

<p><strong>bootstrap_url</strong> Specify the path to the customized DCOS build files, where <code>&lt;workstation_ip&gt;</code> is your workstation IP address and <code>&lt;your_port&gt;</code> is an accessible port other than port 80. All of the nodes that you want to connect to must be able to access the <code>&lt;workstation_ip&gt;</code>. The DCOS installer uses this path to locate the DCOS build files.</p>

<p><strong><a name="cluster-name"></a>cluster_name</strong> Specify the name of your cluster.</p>

<p><strong>exhibitor_zk_hosts</strong> Specify a comma-separated list of one or more Zookeeper node IP addresses to use for configuring the internal Exhibitor instances. Exhibitor uses this Zookeeper cluster to orchestrate it's configuration.</p>

<p><strong>master_list</strong> Specify a JSON-formatted list of your static master IP addresses. This must be specified in JSON list format. You must include the escape characters (<code></code>) as shown in the template.</p>

<p><strong><a name="resolvers"></a>resolvers</strong> Specify a JSON-formatted list of DNS servers for your DCOS host nodes. You must include the escape characters (<code></code>) as shown in the template. Set this parameter to the most authoritative nameservers that you have. If you want to resolve internal hostnames, set it to a nameserver that can resolve them.</p>

<p><em>Caution:</em> If you set the <code>resolvers</code> parameter incorrectly, you will permanently damage your configuration and have to reinstall DCOS.</p></li>
<li><p>Save as <code>genconf/config.json</code>.</p></li>
</ol>

<p>For more examples and advanced options, see the <a href="../configuration-parameters-1-4/">JSON config file options</a>.</p>

<h1><a name="install-bash"></a>Step 4: Configure and install DCOS</h1>

<p>In this step you create a custom DCOS build file on your workstation and then install DCOS onto your cluster.</p>

<p><strong>Tip:</strong> If something goes wrong and you need to rerun your setup, use these cluster <a href="../dcos-cleanup-script/">cleanup instructions</a>.</p>

<!-- Early access URL: https://downloads.mesosphere.com/dcos/EarlyAccess/dcos_generate_config.sh -->

<!-- Stable URL: https://downloads.mesosphere.com/dcos/stable/dcos_generate_config.sh -->

<ol>
<li><p>Download and save the DCOS setup file, <code>dcos_generate_config.sh</code>, to the <code>dcos</code> directory on your workstation. This file is used to create your customized DCOS build file.</p>

<p><strong>Important:</strong> Contact your sales representative or <a href="mailto:&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;">&#x73;&#097;&#108;&#101;&#115;&#064;&#109;&#101;&#115;&#111;&#115;p&#x68;&#x65;&#x72;&#x65;&#x2e;&#x69;&#x6f;</a> to obtain the DCOS setup file.</p></li>
<li><p>From the <code>dcos</code> directory, run <code>dcos_generate_config.sh</code> on your bootstrapping master nodes to generate a customized DCOS build. The setup script starts a Docker container that uses the generic DCOS install files to create customized DCOS build files for your cluster. The build files are output to <code>./genconf/serve/</code>.</p>

<pre><code>$ sudo bash dcos_generate_config.sh
</code></pre>

<p><strong>Tip:</strong> For the install script to work, you must have created <a href="#config-json">genconf/config.json</a> and <a href="#create-script">genconf/ip-detect</a>.</p>

<ol>
<li><p>From the <code>dcos</code> directory, run this command to host the DCOS install package through an nginx Docker container. For <code>&lt;your-port&gt;</code>, specify the port value that is used in the <a href="#config-json">bootstrap_url</a>.</p>

<pre><code>$ docker run -d -p &lt;your-port&gt;:80 -v $PWD/genconf/serve:/usr/share/nginx/html:ro nginx
</code></pre></li>
</ol></li>
<li><p>Run these commands on each of your master nodes to install DCOS using your custom build file.</p>

<ol>
<li><p>SSH to your node:</p>

<pre><code>$ ssh &lt;master-ip&gt;
</code></pre></li>
<li><p>Make a new directory and navigate to it:</p>

<pre><code>$ mkdir /tmp/dcos &amp;&amp; cd /tmp/dcos
</code></pre></li>
<li><p>Download the DCOS installer from the nginx Docker container, where <code>&lt;workstation-ip&gt;</code> and <code>&lt;your_port&gt;</code> are specified in <a href="#config-json">bootstrap_url</a>:</p>

<pre><code>$ curl -O http://&lt;workstation-ip&gt;:&lt;your_port&gt;/dcos_install.sh
</code></pre></li>
<li><p>Run this command to install DCOS on your master node:</p>

<pre><code>$ sudo bash dcos_install.sh master
</code></pre></li>
</ol>

<p><strong>Tip:</strong> Run these commands on your master nodes in succession. Although there is no actual harm to your cluster, DCOS may issue error messages until all of your master nodes are configured.</p></li>
<li><p>Run these commands on each of your agent nodes to install DCOS using your custom build file.</p>

<ol>
<li><p>SSH to your node:</p>

<pre><code>$ ssh &lt;master-ip&gt;
</code></pre></li>
<li><p>Make a new directory and navigate to it:</p>

<pre><code>$ mkdir /tmp/dcos &amp;&amp; cd /tmp/dcos
</code></pre></li>
<li><p>Download the DCOS installer from the nginx Docker container, where <code>&lt;workstation-ip&gt;</code> and <code>&lt;your_port&gt;</code> are specified in <a href="#config-json">bootstrap_url</a>:</p>

<pre><code>$ curl http://&lt;workstation-ip&gt;:&lt;your_port&gt;/dcos_install.sh
</code></pre></li>
<li><p>Run this command to install DCOS on your agent node:</p>

<pre><code>$ sudo bash dcos_install.sh slave
</code></pre></li>
</ol></li>
<li><p>Monitor Exhibitor and wait for it to converge at <code>http://&lt; master-ip &gt;:8181/exhibitor/v1/ui/index.html</code>.</p>

<p><strong>Tip:</strong> This process can take about 10 minutes. During this time you will see the Master nodes become visible on the Exhibitor consoles and come online, eventually showing a green light.</p>

<p><a href="https://docs.mesosphere.com/wp-content/uploads/2015/12/chef-zk-status.png" rel="attachment wp-att-2112"><img src="https://docs.mesosphere.com/wp-content/uploads/2015/12/chef-zk-status.png" alt="chef-zk-status" width="551" height="467" class="alignnone size-full wp-image-2112" /></a></p>

<p>When the status icons are green, you can access the DCOS web interface.</p></li>
<li><p>Launch the DCOS web interface at: http://<code>&lt;load-balanced-ip&gt;</code>/:</p>

<p><a href="https://docs.mesosphere.com/wp-content/uploads/2015/12/dashboardsmall.png" rel="attachment wp-att-1120"><img src="https://docs.mesosphere.com/wp-content/uploads/2015/12/dashboardsmall-800x495.png" alt="dashboardsmall" width="800" height="495" class="alignnone size-large wp-image-1120" /></a></p></li>
</ol>